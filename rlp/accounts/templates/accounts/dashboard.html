{% extends 'accounts/accounts_base.html' %}
{% load bootstrap3 cms_tags staticfiles comments discussion_tags %}

{% block page_title %}Profile{% endblock page_title %}

{% block title %}Profile{% endblock title %}

{% block css %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'js/vendor/chosen/chosen.min.css' %}" media="screen">
{% endblock css %}

{% block hero %}
    {% include "accounts/_hero.html" with user=user edit=True %}
{% endblock hero %}

{% block left_column %}
    <div class="cc-box">
        <img src="{% static "images/logo-CC.png" %}" class="img-responsive"/>
        <p>Submit and search the database of case reports, N of 1 studies, and clinical trial summaries.</p>
        <div class="row">
            <div class="col-xs-6">
                <a href="" class="btn btn-primary btn-block">Search</a>
            </div>
            <div class="col-xs-6">
             <a href="" class="btn btn-primary btn-block">Submit</a>
            </div>
        </div>
    </div>
    {{ block.super }}
{% endblock %}

{% block main_content %}
<div>
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation"{% if tab == 'activity' %} class="active"{% endif %}>
      <a href="{% url 'dashboard' %}">Activity</a>
    </li>
    <li role="presentation"{% if tab == 'discussions' %} class="active"{% endif %}>
      <a href="{% url 'dashboard_tab' tab='discussions' %}">Discussions</a>
    </li>
    <li role="presentation"{% if tab == 'casereports' %} class="active"{% endif %}>
      <a href="{% url 'dashboard_tab' tab='casereports' %}">Case Reports</a>
    </li>
    <li role="presentation"{% if tab == 'documents' %} class="active"{% endif %}>
      <a href="{% url 'dashboard_tab' tab='documents' %}">Docs/Media</a>
    </li>
    <li role="presentation"{% if tab == 'bibliography' %} class="active"{% endif %}>
      <a href="{% url 'dashboard_tab' tab='bibliography' %}">Bibliography</a>
    </li>
  </ul>
</div>
<div class="tab-content">
  <div role="tabpanel" class="tab-pane{% if tab == 'activity' %} active{% endif %}" id="activity">
    {% if tab == 'activity' %}
      {% bootstrap_messages %}
      <form class="form-inline" action="" method="get">
        {% bootstrap_field filter_form.content_type show_label=False %}
        {% bootstrap_field filter_form.project show_label=False %}
        {% bootstrap_field filter_form.user_activity_only %}
        <input class="profile-update btn btn-primary" type="submit" value="Filter"/>
      </form>
      <hr>
      {% include page_template %}
    {% endif %}
  </div>
  <div role="tabpanel" class="tab-pane{% if tab == 'discussions' %} active{% endif %}" id="discussions">
    {% if tab == 'discussions' %}
      {% bootstrap_messages %}
        <div class="clearfix">
          <button class="btn btn-primary pull-right" data-toggle="collapse" href="#topic-form">
            New Discussion
          </button>
        </div>
        <div id="topic-form" class="collapse">
          <p>Start a discussion or post your ideas</p>
          {% with button_label='Post' %}
          {% render_comment_form for user %}
          {% endwith %}
        </div>
      <hr>
      {% render_comment_list for user %}
      {% include page_template %}
    {% endif %}
  </div>
  <div role="tabpanel" class="tab-pane{% if tab == 'casereports' %} active{% endif %}" id="casereports">
    {% if tab == 'casereports' %}
      {% bootstrap_messages %}
      {% for report in case_reports %}
      <p><a href="{% url 'casereport_detail' case_id=report.id title_slug=report.title|slugify %}">
        {{ report.title }}
      </a></p>
      {% endfor %}
      <hr>
      {% include page_template %}
    {% endif %}
  </div>
  <div role="tabpanel" class="tab-pane{% if tab == 'documents' %} active{% endif %}" id="dashboard">
    {% if tab == 'documents' %}
      <div>
        <a href="{% url 'documents:add_document' %}" class="btn btn-primary">
          Add File
        </a>
        <a href="{% url 'documents:add_link' %}" class="btn btn-primary">
          Add Link
        </a>
        <a href="{% url 'documents:add_video' %}" class="btn btn-primary">
          Add Video
        </a>
      </div>

      <hr>

      {% for doc in documents %}
      <div class="row">
        <div class="col-md-11">
          <h3><a href="{{ doc.get_absolute_url }}">{{ doc.title }}</a></h3>
          <p>{{ doc.description|urlize }}</p>
        </div>
        <div class="col-md-1">
          {% with obj=doc %}
            {% if obj.owner == request.user %}
              {% include 'forms/_edit_dropdown.html' with edit_url=obj.get_edit_url delete_url=obj.get_delete_url %}
            {% endif %}
          {% endwith %}
        </div>
      </div>
      <hr>
      {% endfor %}

      {% include page_template %}
    {% endif %}
  </div>
  <div role="tabpanel" class="tab-pane{% if tab == 'bibliography' %} active{% endif %}" id="bibliography">
    {% if tab == 'bibliography' %}
      {% bootstrap_messages %}
      <div>
        <a role="button" href="{% url 'bibliography:reference_search' %}" class="btn btn-primary">
          Add Reference
        </a>
      </div>
      {% for ref in references %}
        {% if ref.owner == request.user %}{% include 'forms/_edit_dropdown.html' with edit_url=ref.get_edit_url delete_url=ref.get_delete_url %}{% endif %}
        {% include 'bibliography/_reference.html' with obj=ref.reference %}
      {% endfor %}
      <hr>
      {% include page_template %}
    {% endif %}
  </div>
</div>
{% endblock main_content %}

{% block js-footer %}{{ block.super }}
  <script src="{% static 'js/vendor/chosen/chosen.jquery.min.js' %}"></script>
{% endblock js-footer %}
