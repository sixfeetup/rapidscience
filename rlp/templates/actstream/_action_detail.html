{% load core_tags %}
{% if action.verb == 'started' %}
  Discussion started
{% elif action.verb == 'added' %}
  Reference posted
{% elif action.verb == 'reply' %}
  Comment
{% else %}
  {{ action.action_object.display_type }}
  {% if action.action_object_content_type.model != 'threadedcomment' %}{{ action.verb }}{% endif %}
{% endif %}
by {% if request.user == action.actor and action.verb != 'reply' %} me {% else %} <a href="{{ action.actor.get_absolute_url }}">{{ action.actor.get_full_name }}</a>{% endif %}
{% if action.verb == 'shared' %} with {{ action.target|link }}
    {% if action.others %}{% for other in action.others %}{% if forloop.last %} and {%  else %}, {% endif %}{{ other.target|link }}{%  endfor %}{% endif %}
{% endif %}
{% if action.action_object_content_type.model == 'threadedcomment' and action.verb != 'started' and action.verb != 'shared' %}
    {%  with comment=action.action_object parent_user=action.action_object.get_parent.user %}
        {% if comment.is_reply or 'casereport' in comment.discussion_root.content_object.get_content_type %}on{% endif %}
        {% if 'casereport' in comment.discussion_root.content_object.get_content_type %}
        <a href="{{ comment.discussion_root.content_object.get_absolute_url }}">
            {% if comment.is_reply %}{{ comment.discussion_root.user }}: {% endif %}
            {{ comment.discussion_root.content_object.title|truncatewords_html:10 }}
        </a>
        {% else %}
        <a href="{{ comment.discussion_root.get_absolute_url }}">
            {% if comment.is_reply %}{{ comment.discussion_root.user }}: {% endif %}
            {{ comment.discussion_root.title|truncatewords_html:10 }}
        </a>
        {% endif %}
    {% endwith %}
{% endif %}
| {{ action.timestamp|date:"j M Y" }}
