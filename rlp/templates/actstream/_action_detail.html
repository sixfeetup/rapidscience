{% load core_tags %}
{#object#}
{% if action.action_object_content_type.model == 'threadedcomment' and action.verb == 'started' %}
    Discussion
{% elif action.action_object_content_type.model == 'threadedcomment' and action.verb == 'shared' %}
    Discussion
{% elif action.action_object_content_type.model == 'threadedcomment' and action.verb == 'comment' %}
    Discussion
{% elif action.action_object_content_type.model == 'threadedcomment' %}{#  I think that only leave 'reply' at this point #}
    Comment
{% else %}
    {{ action.action_object.display_type }}
{% endif %}

{#verb#}
{% if action.verb == 'reply' or action.verb == 'comment' %}
    <!-- verb suppressed to read like Comment by ... -->
{% else %}
  {{ action.verb|verb_alias }}
{% endif %}

{# actor #}
by {% if request.user == action.actor and action.verb != 'reply' %} me {% else %} <a href="{{ action.actor.get_absolute_url }}">{{ action.actor.get_full_name }}</a>{% endif %}

{# target #}
{% if action.verb == 'shared' %} to {{ action.target|link }}
    {% if action.others %}{% for other in action.others %}{% if forloop.last %} and {%  else %}, {% endif %}{{ other.target|link }}{%  endfor %}{% endif %}
{% elif action.verb == 'added' or action.verb == 'uploaded' or action.verb == 'started' or action.verb == 'replied' or action.verb == 'created' %}
    {% if action.others %} to {{ action.others.0.target|link }}
        {% for other in action.others|slice:"1:" %}{% if forloop.last %} and {%  else %}, {% endif %}{{ other.target|link }}{%  endfor %}
    {% endif %}
{% endif %}
{% if action.action_object_content_type.model == 'threadedcomment' and action.verb != 'started' and action.verb != 'shared' %}
    {%  with comment=action.action_object parent_user=action.action_object.get_parent.user %}
        {% if comment.is_reply or 'casereport' in comment.discussion_root.content_object.get_content_type %}on{% endif %}
        {% if 'casereport' in comment.discussion_root.content_object.get_content_type %}
        <a href="{{ comment.discussion_root.content_object.get_absolute_url }}">
            {% if comment.is_reply %}{{ comment.discussion_root.user }}: {% endif %}
            {{ comment.discussion_root.content_object.title|truncatewords_html:10 }}
        </a>
        {% else %}
        <a href="{{ comment.discussion_root.get_absolute_url }}">
            {% if comment.is_reply %}{{ comment.discussion_root.user }}: {% endif %}
            {{ comment.discussion_root.title|truncatewords_html:10 }}
        </a>
        {% endif %}
    {% endwith %}
{% endif %}
{# timestamp #}
| {{ action.timestamp|date:"j M Y" }}
