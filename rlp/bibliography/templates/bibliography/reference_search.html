{% extends 'base.html' %}{% load bootstrap3 %}

{% block body_class %}add-reference{% endblock %}

{% block content %}
    <div class="hero">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-push-3">
                    <h2>New Reference</h2>
                </div>
            </div>
        </div>
    </div>
<div class="container">
    <div class="row">
        <div class="col-md-6 col-xs-12 col-md-push-3">

  <form method="get" action="" class="add-reference-form">
    <label for="id_q" class="section-label">Search *</label>
    <div class="input-group">
      <input class="form-control" id="id_q" name="q" title="Enter a PMID or DOI" type="text" placeholder="Author name, keyword, DOI, PMID..." value="{{ query }}">
      <span class="input-group-btn">
        <button class="btn btn-default searchBtn" type="submit">
          <i class="fa fa-search"></i>
        </button>
        <button class="btn btn-default clearSearch" style="display: none">
          <i class="fa fa-times-circle-o"></i>
        </button>
      </span>
    </div>
  </form>
  {% if results %}
    {% for reference in results %}
      {% include 'bibliography/_reference.html' with obj=reference add_reference=True %}
    {% endfor %}
  {% else %}
    {% if query %}
    <p>No results found.</p>
    {% endif %}
  {% endif %}
</div>
</div>
</div>
{% endblock content %}

{% block js-footer %}{{ block.super }}
  <script>
    $('.form-reference-add').submit(function(event) {
      var form = $(this);
      event.preventDefault();
      // Clear out any old messages
      $('.alert-dismissable').remove();
      $.post($(this).attr('action'), $(this).serialize(), function(data) {
        if (data.messages) {
          $(form).replaceWith(data.messages);
        }
      });
    });
    function buttonDisplay(){
        searchterm = '{{ query }}';
        searchval = $("#id_q").val();
        if (!searchterm) {
            $(".clearSearch").hide();
            $(".searchBtn").show();
        } else if (searchterm == searchval) {
            $(".clearSearch").show();
            $(".searchBtn").hide();
        } else {
            $(".clearSearch").hide();
            $(".searchBtn").show();
        }
    }
    (function($) { $(function() {
        buttonDisplay();
        $("#id_q").keyup(function() {
            buttonDisplay();
        });
        $(".clearSearch").click(function(e){
            $("#id_q").val("");
            buttonDisplay();
            e.preventDefault();
        })
    }); })(jQuery);
  </script>
{% endblock js-footer %}
