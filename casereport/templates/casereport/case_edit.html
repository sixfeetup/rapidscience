{% extends "casereport/search/search.html" %}
{% load mytags %}
{% load static %}

{% block title %}
   {{ casereport.title }}
{% endblock %}

{% block container %}
    <script src="{{STATIC_URL}}/static/js/casereport_edit.js"></script>
    <!-- spinner-->
        <div id="crdb-overlay-loader" class="active">
            <div id="crdb-thinking">
                <div class="crdb-spinner"><div class="crdb-spinner-icon"></div></div>
                <span class="crdb-loader-text">Submitting Your Response ...</span>
            </div>
        </div>

    <div class="pills pull-right">
        <ul class="nav nav-pills">
          <li class="view-report-link"> View report as: </li>
          <li class="active"><a data-toggle="pill" href="#structured_report">Structured Report</a></li>

          <li><a data-toggle="pill" href="#original_report">Original Report</a></li>
      </ul>
  </div>
 </br>
 </br>
 <div class="tab-content">
         <div id="structured_report" class="tab-pane fade in active"><!--first-tab-->
             <div class="container-detail">

        <form class="case_edit_form" action=".">
            <span class="label label-warning no-change">Nothing Changed</span>
            <span class="label label-success success-change">Changes Updated Successfully</span>
            <div class="button_section">
                <input type="hidden" value="" name="action" class="action">
                <input type="submit" class="btn btn-primary edit" value="Edit">
                <input type="submit" class="btn btn-success submit hide" value="Submit">
                <input type="submit" class="btn btn-success approve" value="Approve">
                <input type="submit" class="btn btn-info cancel hide" value="Cancel">
            </div>
            <div class="detail-section">
                <h3>
                    <div class="title_edit_content edit_area_content">
                        <span class="destination">{{ casereport.title }}</span>
                    </div>
                    <div class="hide title_edit edit_area inline_edit">
                        <input class="field" name="title" type="text"/>
                    </div>
                </h3>

                <div class="row detail-result-list">
                    <div class="col-md-2">
                        <span class="age_edit_content edit_area_content">
                            <span class="destination">{{ casereport.age }}</span>
                        </span>
                        <span class="hide age_edit edit_area inline_edit">
                            <input class="field" name="age" type="number" class="form-control" required="required"/>
                        </span>
                    </div>

                    <div class="col-md-2">
                        <span class="gender_edit_content edit_area_content">
                            <span class="destination">{{ casereport.gender }}</span>
                        </span>
                        <span class="hide gender_edit edit_area inline_edit">
                            <select class="field" name="gender">
                                {% for key, value in gender %}
                                    <option value="{{ key }}">{{value }}</option>
                                {% endfor %}
                            </select>
                        </span>
                    </div>

                    <div class="col-md-3">
                        <span class="sarcoma_type_edit_content edit_area_content">
                            <span class="destination">{{ casereport.get_sarcoma_type }}</span>
                        </span>
                        <span class="hide sarcoma_type_edit edit_area inline_edit">
                            <select class="field" name="sarcoma_type">
                                {% for key, value in sarcoma_types %}
                                    <option value="{{ key }}">{{value }}</option>
                                {% endfor %}
                            </select>
                        </span>
                    </div>
                    <div class="col-md-5">
                        <div class="physician_edit_content edit_area_content">
                            {{ casereport.primary_physician }} -
                            {{ casereport.primary_physician.affiliation }}
                        </div>
                        <div class="hide physician_edit edit_area">
                            <textarea class="field" name="physician"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row  custom_edit">
                    <div class="col-md-8 diagnosis-section">
                        <h4> Conditions/Diagnosis</h4>
                        <div class="diagnosis_edit_content edit_area_content">
                            {% for test in casereport.get_diagnosis_events_in_order %}
                                <div class="row diagnosis-section-inner"><span> {{ test.name }} -</span> <p>{{ test.get_diagnosis_specimen }} - {{ test.get_symptoms }}</p></div>
                            {% empty %}
                                <div>Not Specified</div>
                            {% endfor %}
                        </div>
                        <div class="hide diagnosis_edit edit_area">
                            <textarea class="field" name="diagnosis"></textarea>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <h4>  Genetic Aberrations</h4>
                        <div class="abberation_edit_content edit_area_content">
                            {% for abb in casereport.molecular_abberations.all %}
                                <div><span>{{ abb.molecule }}- {{ abb.name }}</span> </div>
                            {% empty %}
                                <div>Not Specified</div>
                            {% endfor %}
                        </div>
                        <div class="hide abberation_edit edit_area">
                            <textarea class="field" name="molecular_abberations"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row treatment-divst custom_edit">
                    <h4>  Treatments</h4>
                    <div class="treatment_edit_content edit_area_content">
                        {% for treatment in casereport.get_treatment_events_in_order %}
                            <div class="row treatment-list-inner"><span >{{ treatment.get_dates }} {{ treatment.get_name }}{% if treatment.get_outcome %} :{% endif %}</span><span>{{ treatment.get_outcome }}</span> </div>
                        {% empty %}
                            <div>Not Specified</div>
                        {% endfor %}
                    </div>
                    <div class="hide treatment_edit edit_area">
                        <textarea class="field" name="treatments"></textarea>
                    </div>
                </div>

                <div class="row  procedures-divst custom_edit">
                    <h4>Tests</h4>
                    <div class="test_edit_content edit_area_content">
                        {% for test in casereport.get_test_events_in_order %}
                            <div class="row procedures-list-inner" ><span>{{ test.get_dates }} {{ test.name }} :</span><span> {{ test.get_test_results }}</span></div>
                        {% empty %}
                            <div>Not Specified</div>
                        {% endfor %}
                    </div>
                    <div class="hide test_edit edit_area">
                        <textarea class="field" name="tests"></textarea>
                   </div>
                </div>

                <div class="row">
                    <div class="date-section pull-right">Last Updated: {{ casereport.modified_on }}</div>
                </div>
            </div>
        </form>
    </div>

         </div>

        <div id="original_report" class="tab-pane fade">
             <div class="raw-text-section">
                    {% if casefile %}
                        <div class="raw-text-file">
                       <h3>Case Report File Uploaded:</h3>

                        {% if casefile.document.name|check_is_image %}
                            <img src="{% url 'media' casefile.document.name|cut:"./" %}">

                            {% else %}
                       File Name:- <a href="{% url 'download' casefile.id %}">{{ casefile.name }}</a> (click to download)
                        {% endif %}
                        </div>
                        {% else %}
                            {% include 'casereport/original_case_text.html' %}
                    {% endif %}
                 </div><!--raw-text-section-end-->
        </div>
  </div>
{% endblock container %}
