{% extends "casereport/search/search.html" %}
{% load mytags %}
{% load static %}



{% block title %}
   {{ casereport.title }}
{% endblock %}
{% block container %}
<div class="container-detail">

{#{% if casefile %}#}
  <div class="pills pull-right">
        <ul class="nav nav-pills">
          <li class="view-report-link"> View report as: </li>
          <li class="active"><a data-toggle="pill" href="#structured">Structured</a></li>

          <li><a data-toggle="pill" href="#raw">Original Report</a></li>
      </ul>
  </div>
{#{% endif %}#}

<div class="headingBanner">
    <div>
        {% if request.META.HTTP_REFERER %}
        <a href="{{request.META.HTTP_REFERER}}">&laquo; Return To Search Results</a>
            {% else %}
            <a href="{% url 'haystac' %}">&laquo; All Cases</a>
        {% endif %}
    </div>
    <h1>{{ casereport.title }}</h1>
    <p>
        Case ID: 1234567890 |
        Submitted: {{ casereport.created_on|date:"M d, Y" }} |
        Last revision: {{ casereport.modified_on|date:"M d, Y" }}
    </p>
</div>

 <div class="tab-content case-detail-view">
     
     <div id="structured" class="tab-pane fade in active"><!--first-tab-->
         <div class="col-md-3 col-xs-3">
             <ul class="jumpMenu">
                 <li><a href="#section-primary">Primary Author/Contact</a></li>
                 <li><a href="#section-coauthors">Co-Authors</a></li>
                 <li><a href="#section-diagnosis">Diagnosis/Presentation</a></li>
                 <li><a href="#section-aberrations">Genetic Aberrations</a></li>
                 <li><a href="#section-pathology">Pathology/Tests</a></li>
                 <li><a href="#section-treatment">Treatment/Outcome</a></li>
                 <li><a href="#section-comments">Additional Comments</a></li>
             </ul>
         </div>
         <div class="col-md-9 col-xs-12">

      <div class="row author-list" id="section-primary">
          <h4>Primary Author/Contact</h4>
          <p>{{ casereport.primary_physician }} | {{ casereport.primary_physician.affiliation }} | {{ casereport.primary_physician.affiliation.city }} | {{ casereport.primary_physician.affiliation.country }}</p>
      </div>

      <div class="row author-list" id="section-coauthors">
          <h4>Co-Authors</h4>
          {% for author in casereport.referring_physician.all %}
                  {% if not casereport.primary_physician.email == author.email %}
                      <div class="author-list-inner"><span>{{ author.name}}</span></div>
                  {% endif%}
          {% empty %}

          {% endfor %}
      {% if casereport.referring_physician.all.count == 1 %}
          <div class="author-list-inner" ><span>Not Specified</span></div>
      {% endif %}

      </div>
      
      <div class="row" id="section-diagnosis">
          <h4>Diagnosis/Presentation</h4>
          <p>
              {{ casereport.age }} yr |
              {{ casereport.gender|capfirst }}
          </p>
      </div>

      <div class="row">
          <!-- <div class="col-md-8 diagnosis-section">
              <h4> Conditions/Diagnosis</h4>
              {% for test in casereport.get_diagnosis_events_in_order %}
                  <div class="row diagnosis-section-inner"> <span> {{ test.name }}:</span> <p>{{ test.get_diagnosis_specimen }}   {{ test.get_symptoms }}</p></div>

              {% empty %}
                <div>Not Specified</div>
              {% endfor %}
          </div> -->

          <div class="molecule-abberation" id="section-aberrations">
              <h4>Genetic Aberrations</h4>
              {% for abb in casereport.molecular_abberations.all %}
                  <div class="row  molecule-abberation-inner"><span><i>{{ abb.molecule }}</i> {{ abb.name }}</span></div>
              {% empty %}
                  <div >Not Specified</div>
              {% endfor %}
          </div>

      </div>
      
      <div class="row" id="section-pathology">
          <h4>Pathology/Tests</h4>
      </div>

      <div class="row treatment-list" id="section-treatment">
          <h4>Treatment/Outcome</h4>
          {% for treatment in casereport.get_treatment_events_in_order %}
              <div class="row treatment-list-inner"><span >{{ treatment.get_dates }} {{ treatment.get_name }}{% if treatment.get_outcome %} :{% endif %}</span><span>{{ treatment.get_outcome }}</span> </div>
          {% empty %}
              <div>Not Specified</div>
          {% endfor %}

      </div>



      <div class="row  procedures-list">
          <h4>Tests</h4>
          {% for test in casereport.get_test_events_in_order %}
              <div class="row procedures-list-inner"><span >{{ test.get_dates }} {{ test.name }} :</span> <span> {{ test.get_test_results }}</span></div>
          {% empty %}
              <div>Not Specified</div>
          {% endfor %}
      </div>
      
      <div class="row" id="section-comments">
          <h4>Additional Comments</h4>
      </div>

         </div>
         <div class="visualClear"><!-- --></div>
    </div>

            <div id="raw" class="tab-pane fade"><!--second-tab-->
                <div class="raw-text-section">
                  {% comment %}
                    {% if not casefile %}
            <h3>{{ casereport.title }}  </h3>
                <h4>   {{ casereport.gender|capfirst }}, {{ casereport.age }}</h4>
               <h4>History</h4> <p >{{ casereport.history }}</p>
            <h4>Precision Treatment</h4><p >{{ casereport.precision_treatment }}</p>
            <h4>Specimen Analyzed</h4><p >{{ casereport.specimen_analyzed }}</p>
            <h4>Outcome</h4><p >{{ casereport.clinical_outcome }}</p>
                {% else %}
                {% endcomment %}
                    {% if casefile %}
                        <div class="raw-text-file">
                       <h3>Case Report File Uploaded:</h3>

                        {% if casefile.document.name|check_is_image %}
                            <img src="/media/{{ casefile.document.name|cut:"./" }}">

                            {% else %}
                       File Name:- <a href="/casereport/download/{{ casefile.id }}">{{ casefile.name }}</a> (click to download)
                        {% endif %}
                        </div>
                        {% else %}
                            {% include 'casereport/original_case_text.html' %}
                    {% endif %}
                 </div><!--raw-text-section-end-->
            </div>

 </div><!--tab content-end-->


</div><!--container-detail-end-->
{% endblock %}
